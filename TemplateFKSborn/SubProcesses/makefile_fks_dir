include ../../../Source/make_opts
include ../../../Source/fj_lhapdf_opts

CC    = g++

LIBDIR = ../../../lib/

FASTJET_CONFIG = $(fastjet_config)
CXXFLAGS += $(shell $(FASTJET_CONFIG) --cxxflags)
FJLIBS += $(shell $(FASTJET_CONFIG) --libs --plugins ) -lstdc++
#FJLIBS += $(shell $(FASTJET_CONFIG) --libs --plugins )
#FJLIBS=

NLOLIBS=$(libmadloop) 
LINKLIBS =  -L$(LIBDIR) -ldhelas -ldsample_fks -lmodel -lgeneric -lpdf $(lhapdf)
LIBS = $(LIBDIR)libdhelas.a $(LIBDIR)libdsample_fks.a $(LIBDIR)libgeneric.a $(LIBDIR)libpdf.a $(LIBDIR)libmodel.a

# Files for all executables
FILES= $(patsubst %.f,%.o,$(wildcard parton_lum_*.f)) $(patsubst %.f,%.o,$(wildcard matrix_*.f)) \
	 real_me_chooser.o parton_lum_chooser.o fks_inc_chooser.o leshouche_inc_chooser.o \
	 genps_fks.o matrix.o setcuts.o setscales.o \
         born.o sborn_sf.o $(patsubst %.f,%.o,$(wildcard b_sf_???.f)) fks_Sij.o trapfpe.o fastjetfortran_madfks.o \
         ktclusdble.o fks_singular.o montecarlocounter.o mirror.o reweight_xsec.o

# Files needed for vegas, mint & mintMC
RUN= $(FILES) cuts.o add_write_info.o LesHouches.o madfks_dbook.o madfks_plot.o

# Files for vegas
VEGAS= $(RUN) driver_vegas.o vegas2.o

# Files for mint
MINT= $(RUN) mint-integrator2.o driver_mint.o

# Files for mintMC
MINTMC= $(RUN) mint-integrator2.o driver_mintMC.o write_event.o handling_lhe_events.o

# Files for tests
TEST= $(FILES) LesHouchesDummy.o cuts.o

# Files for gensym
SYM= $(FILES) LesHouchesDummy.o symmetry_fks_v3.o write_ajob.o

# Files for link_fks
LINK= $(TEST) link_fks.o

# Files for genint_fks
INTEGRATE= genint_fks.o

# Files for event reweighting to get e.g. scale and PDF uncertainties
RWGFILES=reweight_xsec_events.o handling_lhe_events.o reweight_xsec.o auto_dsig.o setscales.o cuts.o fastjetfortran_madfks.o reweight_xsec_events_pdf_dummy.o

%.o : %.f
	$(F77) $(FFLAGS) -c $<
%.o : %.for
	$(F77) $(FFLAGS) -c $<
%.o: %.c
	$(CC) -g -c $^
%.o: %.cc
	$(CC) -g -c $(CXXFLAGS) $^

genint_fks: $(INTEGRATE)
	$(F77) $(FFLAGS) -o genint_fks $(INTEGRATE)

link_fks: $(LINK)
	$(F77) $(FFLAGS) -o link_fks $(LINK) $(LINKLIBS) $(FJLIBS)
	rm fks_singular.o genps_fks.o

gensym: $(SYM)
	$(F77) $(FFLAGS) -o gensym $(SYM) $(LINKLIBS) $(FJLIBS)
	rm fks_singular.o

test_Sij: symmetry_fks_test_Sij.o $(TEST)
	$(F77) $(FFLAGS) -o test_Sij symmetry_fks_test_Sij.o $(TEST) $(LINKLIBS) $(FJLIBS)

test_ME: symmetry_fks_test_ME.o $(TEST)
	$(F77) $(FFLAGS) -o test_ME symmetry_fks_test_ME.o $(TEST) $(LINKLIBS) $(FJLIBS)

test_MC: symmetry_fks_test_MC.o $(TEST) 
	$(F77) $(FFLAGS) -o test_MC symmetry_fks_test_MC.o $(TEST) $(LINKLIBS) $(FJLIBS)

madevent_vegas: $(VEGAS)  makefile $(LIBS)
	$(F77) $(FFLAGS) -o madevent_vegas $(VEGAS) $(NLOLIBS) $(LINKLIBS) $(FJLIBS)

madevent_mint: $(MINT)  makefile $(LIBS)
	$(F77) $(FFLAGS) -o madevent_mint $(MINT) $(LINKLIBS) $(FJLIBS)

madevent_mintMC: $(MINTMC)  makefile $(LIBS)
	$(F77) $(FFLAGS) -o madevent_mintMC $(MINTMC) $(LINKLIBS) $(FJLIBS)

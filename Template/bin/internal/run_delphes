#!/bin/bash
#
#  This runs pgs on the pythia_events.hep
#
#  Usage: run_pgs [pgsdir [para/serial [run_name]]]
#  where pgsdir is the path to the pgs executable

delphesdir=$1
run=$2


main=`pwd`

if [ ! -e ../Cards/delphes_card.dat ]; then
  echo "No delphes_card.dat found. Quitting..."
  exit
fi

if [ ! -e $delphesdir/Delphes ]; then
  echo "No Delphes executable found. Quitting..."
  exit
fi

echo $$ >> ../myprocid

rm -f delphes.log > /dev/null
rm -f delphes.err > /dev/null
rm -f delphes.out > /dev/null

echo pythia_events.hep > inputfiles.list

# Set delphes path in delphes_card.dat

sed -e "s:DELPHESDIR:$delphesdir:g" ../Cards/delphes_card.dat > ../Cards/tmp_card.dat


$delphesdir/Delphes inputfiles.list delphes.root ../Cards/tmp_card.dat ../Cards/delphes_trigger.dat >& delphes.log
$delphesdir/LHCO_Only delphes.root >> delphes.log


if [[ -e delphes.err ]];then
  cat delphes.err
fi

if [ -e delphes_events.lhco ]; then
# write the delphes banner
    sed -e "s/^/#/g" ${run}_banner.txt > ${run}_delphes_events.lhco
    cat delphes_events.lhco >> ${run}_delphes_events.lhco
    rm -f delphes_events.lhco
fi

#!/bin/bash
#
#  This runs pgs on the pythia_events.hep
#
#  Usage: run_pgs [pgsdir [para/serial [run_name]]]
#  where pgsdir is the path to the pgs executable

pgsdir=$1
main=`pwd`
run=$2

if [ ! -e ../Cards/pgs_card.dat ]; then
  echo "No pgs_card.dat found. Quitting..."
  exit
fi

echo $$ >> ../myprocid

export PDG_MASS_TBL=$pgsdir/mass_width_2004.mc

rm -f pgs.log > /dev/null
rm -f pgs.err > /dev/null
rm -f pgs.out > /dev/null

  $pgsdir/pgs  --stdhep pythia_events.hep --nev 100000 --L0 --detector ../Cards/pgs_card.dat pgs_uncleaned_events.lhco >& pgs.log
  $pgsdir/clean_output -muon pgs_uncleaned_events.lhco pgs_events.lhco


if [[ -e pgs.err ]];then
   cat pgs.err
fi

if [[ ! -e pgs_events.lhco && -e pgs_uncleaned_events.lhco ]];then
    mv pgs_uncleaned_events.lhco pgs_events.lhco
fi

if [ -e pgs_events.lhco ]; then
# pgs_card.dat
    if [ -e ../Cards/pgs_card.dat ]; then
      echo "<MGPGSCard>" >> banner.txt
      cat ../Cards/pgs_card.dat   >> banner.txt
      echo "</MGPGSCard>" >> banner.txt
    fi
# write the pgs banner
    sed -e "s/^/#/g" banner.txt > temp.dat
    cat pgs_events.lhco >> temp.dat
    rm -f pgs_events.lhco
    mv -f temp.dat pgs_events.lhco
fi
# Remove tauola output file
rm -f fort.45 > /dev/null
